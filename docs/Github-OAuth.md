# Using Github as an external OAuth provider with S.H.I.E.L.D

Github can be used as an external OAuth2 provider for controlling SHIELD authorizations.

This will work for both public Github accounts, and on-premise Github enterprise accounts.This means existing authorization structures can be carried over into SHIELD with minimal additional setup;  Just define what Github Orgs need access, and what rights individual teams within those orgs have.

## Open the Github settings page

![GitHub Setup](/images/githubAuth/github1.png)

![GitHub Setup](/images/githubAuth/github2.png)

## Open "OAuth Apps" under the "Developer settings" field on the lower left menu

![GitHub Setup](/images/githubAuth/github3.png)


## Register a new Github OAuth client with the "Register a new application" button

![GitHub Setup](/images/githubAuth/github4.png)

- The `Authorization callback URL field must be set to:
  - `http://$shield/auth/oauth/$identifier/redir`
  - $shield: the address of this SHIELD instance
  - $identifier: any name so that the SHIELD backend can identify which OAuth Client was in use for things like logs and auditing
- The other fields will be different on a per SHIELD basis, as this client will be specific to this instance of SHIELD
- Github will now generate a client id and client secret that will need to be put in the SHIELD configuration file.

## Add the configuration for the Github OAuth client

This will be added to the already existing configuration YAML file used to deploy shield under a new field called `auth`

### required fields are:

- __name__ - Displayed in the UI and CLI when interacting with SHIELD
- __identifier__ - Used in the "Authorization callback URL" field during the Github OAuth client setup. The SHIELD backend will use this to identify which OAuth Client was in use for things like logs and auditing.
- __backend__ - A static value defined by SHIELD; It will always be `github` for this configuration
- __properties__:
  - __client_id__ - Auto generated by Github during OAuth client creation.
  - __client_secret__ - Auto generated by Github during OAuth client creation.
  - __mapping__ - Maps Github orgs to SHIELD tenants.  For each Github organization, configure a mapping from a SHIELD tenant (with any name) to a preexisting Github org name.
  Then, using Github teams within the above Github org, map what role users will have in the generated SHIELD tenant.  SHIELD can also accept a base case role for all users that do not belong to one of the matching Github teams provided.
    - __tenant__ - Any name.  SHIELD will create an internal SHIELD tenant with this given name
    - __rights__ - Maps Github teams to a predefined SHIELD role, as well as a default role for all users that don't belong to any of the specified Github teams
      - __team__ - The name of one of the Github teams in the Github organization
      - __role__ - One of three predefined SHIELD roles
        - admin
        - operator
        - engineer

### Example config used for SHIELD development:

```yaml
auth:
  - name:       Github
    identifier: public-gh
    backend:    github
    properties:
      client_id:     435abbcea49c948f8ab3
      client_secret: ffab373bc287d40ba73476bff3f449
      mapping:
        starkandwayne:           # <-- github org name
          tenant: starkandwayne  # <-- shield tenant name
          rights:
            - team: Owners       # <-- github team name
              role: admin        # <-- shield role name
            - team: Engineering  #   (first match wins)
              role: engineer
            - role: operator     # = (default match)
        cloudfoundry-community:
          tenant: CF Community
          rights:
            - role: engineer

```