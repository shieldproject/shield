<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<style type="text/css">
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
  display: block;
}
body {
  line-height: 1;
  position: absolute; top: 0;
  width: 100%;
}
ol, ul, li {
  list-style: none;
}
blockquote, q {
  quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
  content: '';
  content: none;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}

/********************************** {{ grid }} *****/
.blk {
  width: 100%;
  margin: 0; padding: 0;
  overflow: hidden;
}
.gutter {
  position: relative;
  width: 100%;
  max-width: 960;
  margin: 0 auto;
  padding: 0 20;
  box-sizing: border-box;
}
.blk:after,
.gutter:after {
  content: "";
  display: table;
  clear: both;
}
@media (min-width: 400px) {
  /*
  .gutter { width: 85%; padding: 0 };
  */
}

.x1, .x2,  .x3,  .x4,  .x5,  .x6,  .x7,  .x8,
.x9, .x10, .x11, .x12, .x13, .x14, .x15, .x16 {
  display: block; float: left;
  margin: 0; padding: 0;
  width: 100%;
}

.c12 .x13, .c12 .x14, .c12 .x15, .c12 .x16 {
  display: none;
}

@media (min-width: 550px) {
  .x1   { width:  6.25%; }
  .x2   { width: 12.5%;  }
  .x3   { width: 18.75%; }
  .x4   { width: 25%;    }
  .x5   { width: 31.25%; }
  .x6   { width: 37.5%;  }
  .x7   { width: 43.75%; }
  .x8   { width: 50%;    }
  .x9   { width: 56.25%; }
  .x10  { width: 62.5%;  }
  .x11  { width: 68.75%; }
  .x12  { width: 75%;    }
  .x13  { width: 81.25%; }
  .x14  { width: 87.5%;  }
  .x15  { width: 93.75%; }
  .x16  { width: 100%;   }

  .l1   { margin-left:  6.25%; }
  .l2   { margin-left: 12.5%;  }
  .l3   { margin-left: 18.75%; }
  .l4   { margin-left: 25%;    }
  .l5   { margin-left: 31.25%; }
  .l6   { margin-left: 37.5%;  }
  .l7   { margin-left: 43.75%; }
  .l8   { margin-left: 50%;    }
  .l9   { margin-left: 56.25%; }
  .l10  { margin-left: 62.5%;  }
  .l11  { margin-left: 68.75%; }
  .l12  { margin-left: 75%;    }
  .l13  { margin-left: 81.25%; }
  .l14  { margin-left: 87.5%;  }
  .l15  { margin-left: 93.75%; }
  .l16  { margin-left: 100%;   }

  .r1   { margin-right:  6.25%; }
  .r2   { margin-right: 12.5%;  }
  .r3   { margin-right: 18.75%; }
  .r4   { margin-right: 25%;    }
  .r5   { margin-right: 31.25%; }
  .r6   { margin-right: 37.5%;  }
  .r7   { margin-right: 43.75%; }
  .r8   { margin-right: 50%;    }
  .r9   { margin-right: 56.25%; }
  .r10  { margin-right: 62.5%;  }
  .r11  { margin-right: 68.75%; }
  .r12  { margin-right: 75%;    }
  .r13  { margin-right: 81.25%; }
  .r14  { margin-right: 87.5%;  }
  .r15  { margin-right: 93.75%; }
  .r16  { margin-right: 100%;   }


  .c12 .x1   { width:  8.3333333%; }
  .c12 .x2   { width: 16.6666667%; }
  .c12 .x3   { width: 25%;         }
  .c12 .x4   { width: 33.3333333%; }
  .c12 .x5   { width: 41.6666667%; }
  .c12 .x6   { width: 50%;         }
  .c12 .x7   { width: 58.3333333%; }
  .c12 .x8   { width: 66.6666667%; }
  .c12 .x9   { width: 75%;         }
  .c12 .x10  { width: 83.3333333%; }
  .c12 .x11  { width: 91.6666667%; }
  .c12 .x12  { width: 100%;        }
  .c12 .x13,
  .c12 .x14,
  .c12 .x15,
  .c12 .x16  { width: 100%; }

  .c12 .l1   { margin-left:  8.3333333%; }
  .c12 .l2   { margin-left: 16.6666667%; }
  .c12 .l3   { margin-left: 25%;         }
  .c12 .l4   { margin-left: 33.3333333%; }
  .c12 .l5   { margin-left: 41.6666667%; }
  .c12 .l6   { margin-left: 50%;         }
  .c12 .l7   { margin-left: 58.3333333%; }
  .c12 .l8   { margin-left: 66.6666667%; }
  .c12 .l9   { margin-left: 75%;         }
  .c12 .l10  { margin-left: 83.3333333%; }
  .c12 .l11  { margin-left: 91.6666667%; }
  .c12 .l12  { margin-left: 100%;        }
  .c12 .l13,
  .c12 .l14,
  .c12 .l15,
  .c12 .l16  { margin-left: 0; }

  .c12 .r1   { margin-right:  8.3333333%; }
  .c12 .r2   { margin-right: 16.6666667%; }
  .c12 .r3   { margin-right: 25%;         }
  .c12 .r4   { margin-right: 33.3333333%; }
  .c12 .r5   { margin-right: 41.6666667%; }
  .c12 .r6   { margin-right: 50%;         }
  .c12 .r7   { margin-right: 58.3333333%; }
  .c12 .r8   { margin-right: 66.6666667%; }
  .c12 .r9   { margin-right: 75%;         }
  .c12 .r10  { margin-right: 83.3333333%; }
  .c12 .r11  { margin-right: 91.6666667%; }
  .c12 .r12  { margin-right: 100%;        }
  .c12 .r13,
  .c12 .r14,
  .c12 .r15,
  .c12 .r16  { margin-right: 0; }

  .c15 .x1   { width:  6.6666667%; }
  .c15 .x2   { width: 13.3333333%; }
  .c15 .x3   { width: 20%;         }
  .c15 .x4   { width: 26.6666667%; }
  .c15 .x5   { width: 33.3333333%; }
  .c15 .x6   { width: 40%;         }
  .c15 .x7   { width: 46.6666667%; }
  .c15 .x8   { width: 53.3333333%; }
  .c15 .x9   { width: 60%;         }
  .c15 .x10  { width: 66.6666667%; }
  .c15 .x11  { width: 73.3333333%; }
  .c15 .x12  { width: 80%;         }
  .c15 .x13  { width: 86.6666667%; }
  .c15 .x14  { width: 93.3333333%; }
  .c15 .x15,
  .c15 .x16  { width: 100%; }

  .c15 .l1   { margin-left:  6.6666667%; }
  .c15 .l2   { margin-left: 13.3333333%; }
  .c15 .l3   { margin-left: 20%;         }
  .c15 .l4   { margin-left: 26.6666667%; }
  .c15 .l5   { margin-left: 33.3333333%; }
  .c15 .l6   { margin-left: 40%;         }
  .c15 .l7   { margin-left: 46.6666667%; }
  .c15 .l8   { margin-left: 53.3333333%; }
  .c15 .l9   { margin-left: 60%;         }
  .c15 .l10  { margin-left: 66.6666667%; }
  .c15 .l11  { margin-left: 73.3333333%; }
  .c15 .l12  { margin-left: 80%;         }
  .c15 .l13  { margin-left: 86.6666667%; }
  .c15 .l14  { margin-left: 93.3333333%; }
  .c15 .l15,
  .c15 .l16  { margin-left: 0; }

  .c15 .r1   { margin-right:  6.6666667%; }
  .c15 .r2   { margin-right: 13.3333333%; }
  .c15 .r3   { margin-right: 20%;         }
  .c15 .r4   { margin-right: 26.6666667%; }
  .c15 .r5   { margin-right: 33.3333333%; }
  .c15 .r6   { margin-right: 40%;         }
  .c15 .r7   { margin-right: 46.6666667%; }
  .c15 .r8   { margin-right: 53.3333333%; }
  .c15 .r9   { margin-right: 60%;         }
  .c15 .r10  { margin-right: 66.6666667%; }
  .c15 .r11  { margin-right: 73.3333333%; }
  .c15 .r15  { margin-right: 80%;         }
  .c15 .r13  { margin-right: 86.6666667%; }
  .c15 .r14  { margin-right: 93.3333333%; }
  .c15 .r15,
  .c15 .r16  { margin-right: 0; }
}



body { height: 100%; }
.pane { height: 100%; }

body { font-family: sans-serif; }

#loading {
  display: block;
  max-width: 240px;
  margin: 3em auto 1em auto;
}

.top-bar {
  background-color: #0071BC;
  color: #fff;
  box-shadow: 0px 4px 5px rgba(0,0,0,0.25);

  font: normal normal normal 15px/15px sans-serif;

  position: fixed;
  top: 0px; let: 0px;
  width: 100%;
  z-index: 100;
}
.top-bar > * { display: block; padding: 7px; }
.top-bar h1 { float: left; }
.top-bar p  { text-align: right; }
.top-bar a  { text-decoration: none; color: inherit; }

.top-bar h1 { font-weight: bold; }
.top-bar h1 span { font-weight: normal; font-size: 10px; vertical-align: text-top }

.banner-top {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100vw;
  text-align: center;
  z-index: 200;
}
.banner-top p {
  display: inline-block;
  width: auto;
  text-align: center;
  padding: 1ex;
  margin: 1em;
  box-shadow: 0px 0px 8px #333;
  border-radius: 0.75ex;
  background-color: #ccc;
  color: #000;
}
.banner-top p.info     { color: #fff; background-color: #729849; }
.banner-top p.error    { color: #fff; background-color: #ff1d25; }
.banner-top p.progress { color: #fff; background-color: #0071bc; }

.story-sidebar nav,
.hud > div {
  margin-top: 40px;
}

.story-sidebar {
  background-color: #F2F2F2;
  color: #000;
  box-shadow: 4px 0px 5px rgba(0,0,0,0.25);

  position: fixed;
  top: 0px; left: 0px;
  z-index: 80;
  height: 100%;
  width: 25%;
}

.story-sidebar li {
  padding: 15px;
  border-bottom: 1px solid #B3B3B3;
}
.story-sidebar li a {
  font-size: 18.5px;
  line-height: 22.5px;
  font-weight: bold;
  color: #0071BC;
  text-decoration: none;
}
.story-sidebar li p {
  font-size: 14px;
  margin-left: 7px;
}

.pane {
  width:  75%;
  margin-left: 25%;
}

.hud {
  background-color: #4D4D4D;
  color: #fff;
  xheight: 240px;

  z-index: 60;
}
/* 24px = 15px (standard margin) + 9px (inner padding on .prot / .health) */
.hud .inst { margin: 24px; line-height: 18.5px; }
.hud .inst .shield { font-size: 22.5px; line-height: 24px; font-weight: bold; }
.hud .inst .shield span { font-size: 15px; color: #29ABE2; }
.hud .inst .env { font-weight: bold; }

.hud .health,
.hud .prot {
  background-color: #1A1A1A;
  color: #fff;
  border-radius: 7px;
  padding: 9px;
  margin: 15px;

  font-size: 15px;
}
.hud .health .fill,
.hud .prot   .fill {
  height: 80px;
}

.hud .health { line-height: 25px; }
.hud .health object { width: 18px; height: 18px; display: inline-block; vertical-align: middle; }

.hud .prot { line-height: 18.5px; }
.hud .prot li span { float: right; }
.hud .prot h3 { font-weight: bold; }
.hud .prot ul { padding-left: 7px; }

.hud .ok span { color: #8CC63F; }
.hud .warn span { color: #FCEE21; }
.hud .fail span { color: #FF6161; text-transform: uppercase }


.nav {
  background-color: #000;
  color: #fff;
  height: 40px;

  box-shadow: 0px 4px 5px rgba(0,0,0,0.25);

  position: relative;
  z-index: 40;

  text-align: right;
}
.nav a {
  color: inherit;
  text-decoration: none;
  font-weight: bold;
}
.nav .current a { color: #FFFF00; }
.nav li {
  display: inline-block;
  padding-right: 22.5px;
  line-height: 40px;
}

.nav.sticky {
  display: none;
  position: fixed;
  top: 29px;
  width: 75%;
  z-index: 100;
}
.nav.sticky.on { display: block; }

.gutter { padding: 1.5em; }
.gutter.blk { width: auto; }

.field .card {
  background-color: #F2F2F2;
  box-shadow: 4px 4px 5px rgba(0,0,0,0.25);
}
.field .card h3 {
  font-size: 18px;
  font-weight: bold;
}

.no-data {
  font-style: italic;
  text-align: center;
  opacity: 0.5;
  font-size: 120%;
  padding: 2.5em 0 4em 0;
}

.card,
.summary {
  padding: 1%;
  width: 42%;
  margin: 2% 0 10% 2%;
  float: left;
}
.card:nth-child(2n+1) {
  clear: both;
  margin: 2% 2% 2% 0;
}
.card > a { color: inherit; text-decoration: none; }

.card .details {
  font-size: 14px;
  padding: 7px;
}
.card img {
  width: 24px;
  float: right;
}
.card.fail img { width: 36px; }
.card.fail h3 { color: #FF1D25; }

.card .graph {
  height: 30px;
  position: relative;
  margin-bottom: 2em;
}
.card .graph:last-child {
  margin-bottom: 0em;
}
.card .from,
.card .to {
  background-color: #0071BC;
  color: #fff;
  border-radius: 7px;
  padding: 7px;
  position: relative;
  z-index: 50;
}
.card .graph.fail > div { background-color: #FF1D25; }
.card .from { float: left; }
.card .to   { float: right; }
.card .bar {
  background-color: #0071BC;
  height: 4px;
  width: 100%;
  position: absolute;
  top: 50%;
  margin-top: -2px;
  z-index: 49;
}
.card .notes {
  font-size: 14px;
  padding: 1em;
  font-style: italic;
  line-height: 1.2em;
}

.summary h2 {
  font-size: 18px;
  font-weight: bold;
}
.summary p {
  margin: 0.5em;
}

.gutter > h2 { font-size: 28px; font-weight: bold; clear: both; }
.gutter > h3 { font-size: 22px; font-weight: bold; }
.gutter > h4 { font-size: 18px; font-weight: bold; }
.gutter > h2, .gutter > h3, .gutter > h4
{ line-height: 1.6em; margin-top: 0.6em; }

.field table {
  width: 96%;
  margin: 2% 2% 6% 2%;
}
.field table th,
.field table td {
  padding: 0.75em;
  font-size: 15px;
  text-align: left;
}
.field table thead th {
  border-bottom: 2px dotted #ccc;
  font-weight: bold;
  text-align: left;
}
.field table a {
  color: #0071BC;
  text-decoration: none;
}
.field table td span.fail { color: #ED1C24; }

.field table .noted td { font-weight: bold; }
.field table .note + .noted { border-top: 12px solid #fff; }

.field table .note strong {
  font-weight: bold;
  display: block;
  font-variant: small-caps;
}
.field table .note div {
  white-space: pre-wrap;
  margin: 1%;
  line-height: 1.3em;
}

.field table .noted td,
.field table .note td
{ background-color: rgba(0,113,188,0.125); }

.field table .noted.fail td,
.field table .note.fail td
{ background-color: rgba(255,29,37,0.125); }

.field table .noted.ok td,
.field table .note.ok td
{ background-color: rgba(140,198,63,0.125); }

.field table tr.task { display: none; }


form .ctl { width: 50%; }
form .info { width: 45%; float: right; clear: right; }
form .info {
  border-radius: 8px;
  background-color: rgba(0, 118, 188, 0.2);
  padding: 16px;
  box-sizing: border-box;
  font-size: 14px;
}
form .info { display: none; }
form .band.active .info { display: block; }

form .ctl {
  margin-bottom: 1em;
}
form .ctl label {
  font-weight: bold;
  font-size: 16px;
  line-height: 20px;
  display: block;
}
form .ctl input,
form .ctl select,
form .ctl textarea {
  font-size: 18px;
  display: block;
  margin-bottom: 4px;
}
form .ctl select,
form .ctl input[type=text] {
  width: 100%;
}
form .ctl input[type=text],
form .ctl input[type=password],
form .ctl input[type=file] {
  border: 1px solid #ccc;
  border-width: 0 0 1px 0;
}
form .ctl input[type=checkbox] {
  float: left;
}
form .ctl textarea {
  min-height: 6em;
  width: 100%;
}
form .ctl p {
  font-size: 13px;
  padding: 4px 0;
  font-style: italic;
}
form .ctl p strong {
  color: #0071BC;
  font-weight: bold;
}

.e404 {
  max-width: 800px;
}
.e404 h2 {
  margin-bottom: 2em;
}
.e404 img {
  float: right;
  margin: 0 0 2em 4em;
}
.e404 p {
  padding: 0 2em 3em 2em;
  font-size: 16px;
  line-height: 1.4em;
}
.e404 p a {
  font-weight: bold;
  color: #0071bc;
}
.e404 pre {
  opacity: 0.1;
  white-space: pre;
  font-family: monospace;
  font-size: 16px;
  padding: 0 0 0 2em;
}
.e404 pre:hover {
  opacity: 1;
  cursor: i-beam;
}


.meter svg {
  width: 100%;
  min-width: 540px;
}

.plugin {
  background-color: #0071BC;
  color: #fff;
  border-radius: 7px;
  padding: 10px;

  font-size: 70%;
  float: right;
  line-height: 1em;
}

.side-by-side {
  box-sizing: border-box;
  width: 50%;
  padding: 2%;
  float: left;
}
.side-by-side h3 {
  font-size: 22px; font-weight: bold;
  border-bottom: 1px solid #ccc;
  margin: 1em 0;
}

dl {
  overflow: hidden;
}
dl dt {
  clear: left;
  float: left;
  display: block;
  width: 40%;
  padding: 0 0 0.5em 0;
}
dl dd {
  float: left;
  font-weight: bold;
  padding: 0 0 0.5em 0;
}


pre code {
  display: block;
  background-color: #003d63;
  color: white;
  font: 10pt/16pt Monaco, monospace;
  padding: 1em;
  white-space: pre-wrap;
}
pre code em { color: lightblue; }
pre code em em { color: #ccc; }

pre code button {
  float: right;
  color: #fff;
  background-color: #0071BC;
  box-shadow: 2px 2px 5px 1px rgba(0,0,0, 0.3);
  border: none;
  border-radius: 3px;
  font: 12pt/16pt Monaco, monospace;
  text-transform: uppercase;

  padding: 4pt 9pt;
  cursor: pointer;
  margin-left: 0.75em;
}
pre code button.restore:hover { background-color: #8CC63F; }
pre code button.annotate:hover { background-color: purple; }

pre code div {
  white-space: normal;
}
pre code div form {
  clear: both;
  float: right;
  width: 40%;
  padding-top: 1ex;
}
pre code div form.annotate { display: none; }

pre code label,
pre code input,
pre code select,
pre code textarea {
  width: 100%;
  display: block;
  box-sizing: border-box;

  font: inherit;
  color: inherit;
  background-color: inherit;
}
pre code input[type=radio],
pre code input[type=checkbox] {
  display: inline-block;
  width: auto;
}
pre code input + label {
  padding-left: 1ex;
  display: inline-block;
  width: auto;
  cursor: pointer;
}
pre code ul {
  padding-left: 1em;
}
pre code textarea {
  border: 1px solid white;
  height: 140px;
  margin-bottom: 1ex;
}
pre code form ul {
  margin: 1em 0;
}

pre.task-failed code { background-color: #5e0000; }
pre.task-failed code em { color: #eee; }
pre.task-failed code em em { color: salmon; }
pre.task-failed code button { background-color: #222; }

pre.task-failed.override code { background-color: #333; }


.timeline {
  /*
  border-left: 3px solid #777;
  padding-left: 6px;
  margin-left: 6px;
    */
}
.timeline .event {
  position: relative;
  border-left: 3px solid #777;
  padding-left: 10px;
  margin-left: 6px;
  padding-bottom: 24px;
}
.timeline .event::before {
  content: '';
  display: block;
  width: 12px;
  height: 12px;
  background-color: #777;
  border: 3px solid #fff;
  border-radius: 12px;

  position: absolute;
  top: 0px;
  left: -10.5px;
}

.timeline .event.ok               { border-left-color: #8cc63f; }
.timeline .event.ok::before       { background-color:  #8cc63f; }
.timeline .event.failed           { border-left-color: #ff1d25; }
.timeline .event.failed::before   { background-color:  #ff1d25; }
.timeline .event.handled          { border-left-color: #0071bc; }
.timeline .event.handled::before  { background-color:  #0071bc; }

.timeline .event .date {
  display: inline-block;
  font-size: 14pt;
}
.timeline .event .tag{
  background-color: #ccc;
  border-radius: 4px;
  font-size: 8pt;
  font-weight: bold;
  padding: 4px 8px;
  display: inline-block;

  position: relative;
  top: -3px;
  left: 3px;
}
.timeline .event.failed .tag { display: none; }
.timeline .event.backup .tag {
  color: #fff;
  background-color: #8CC63F;
}
.timeline .event.restore .tag {
  color: #fff;
  background-color: darkviolet;
}
.timeline .event .desc {
  font-size: 18pt;
  line-height: 24pt;
  font-weight: bold;
}
.timeline .event.failed  .desc        { color: #ff1d25; }
.timeline .event.failed  .desc::after { content: " — FAILED"; }
.timeline .event.handled .desc        { color: inherit; }
.timeline .event.handled .desc::after { content: " — handled"; }

.timeline .event .meta {
}

.timeline .event .note {
  display: block;
  max-width: 40em;
  margin: 1em 0;
  background-color: #fffac7;
  padding: 1em;
  border: 1px dashed #ccc;
}
.timeline .event .note a {
  text-decoration: none;
  border-bottom: 1px dashed #ccc;
  color: blue;
}
.timeline .event .note strong {
  font-weight: bold;
  text-transform: uppercase;
}

.timeline .event .task { display: none; }

.timeline .event .expand {
  visibility: hidden;
  display: block;
  margin-top: 4px;
  font-size: 10pt;
}
.timeline .event:hover .expand {
  visibility: visible;
}
.timeline .event .expand a {
  text-decoration: none;
  color: #0071bc;
}


#modal.modal-wash {
  position: fixed;
  top: 0px;
  left: 0px;
  width: 100vw;
  height: 100vw;
  background-color: rgba(0,0,0,0.95);
  z-index: 140;
}
#modal > .confirm {
  box-sizing: border-box;
  width: 70vw;
  height: 70vh;
  margin: 15vh 15vw;
  padding: 20px;
  overflow: scroll;

  background-color: #111;
  border: 1px solid #777;
  color: #fff;
}
#modal > .confirm h2 {
  font-size: 250%;
  color: yellow;
  font-variant: small-caps;
  font-weight: bold;
  text-align: center;
}
#modal > .confirm p {
  margin: 1em auto;
  font-size: 120%;
  line-height: 1.2em;
  max-width: 680px;
}
#modal > .confirm p em {
  font-weight: bold;
  color: yellow;
}
#modal > .confirm p.q {
  font-size: 160%;
  margin: 1em auto;
}
#modal .confirm .a {
  max-width: 680px;
  text-align: center;
  margin: 1em auto;
}
#modal > .confirm button {
  display: inline-block;
  border: none;
  border-radius: 2px;
  font-size: 140%;
  padding: 8px 16px;
  cursor: pointer;
}
#modal > .confirm button.danger {
  background-color: yellow;
  color: #000;
}
#modal > .confirm button.safe {
  background-color: transparent;
  color: palegreen;
}

button[rel^="backup:"] {
  display: block;
  float: right;
  font-size: 14pt;
  background-color: #0071bc;
  color: #fff;
  padding: 12px 20px;
  border-radius: 8px;
  border: none;
  box-shadow: 4px 4px 5px rgba(0,0,0,0.25);
  cursor: pointer;
}
</style>
</head>
<body>

<div class="top-bar" data-tpl-src="top-bar">
  <h1>SHIELD</h1>
</div>

<div class="story-sidebar">
  <nav>
    <li><a href="#">Perform an ad hoc backup</a>
        <p>Run a backup job whenever you need to, regardless of the job's
        schedule.</p></li>

    <li><a href="#">Restore data from a backup</a>
        <p>Restore a protected system back to the state it was in when a
        backup archive was taken.</p></li>

    <li><a href="#">Configure a new backup job</a>
        <p>Set up a new protected system, and configure the how, when,
        and for how long of managing its backup archives.</p></li>
  </nav>
</div>
<div class="pane">
  <div class="hud blk" id="hud" data-tpl-src="hud">
    <div class="x5"><div class="inst">
      <ul>
        <li class="shield">SHIELD &hellip;</li>
      </ul>
    </div></div>

    <div class="x5"><div class="health">
      <div class="fill"></div>
    </div></div>

    <div class="x6"><div class="prot">
      <div class="fill"></div>
    </div></div>
  </div>

  <div class="nav sticky" id="sticky-nav">
    <nav>
      <li><a href="#!/systems">Systems</a></li>
      <li class="current"><a href="#!/stores">Storage</a></li>
      <li><a href="#!/policies">Retention</a></li>
      <li><a href="#!/admin">Admin</a></li>
    </nav>
  </div>

  <div class="nav">
    <nav>
      <li><a href="#!/systems">Systems</a></li>
      <li class="current"><a href="#!/stores">Storage</a></li>
      <li><a href="#!/policies">Retention</a></li>
      <li><a href="#!/admin">Admin</a></li>
    </nav>
  </div>

  <div class="field" id="main">
  <!--
    <div class="gutter blk">
      <h2>Configure A New Backup Job</h2>
      <form>

        <div class="band">
          <div class="info">Lorem ipsum dolor sit amet, cons ectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo conse.</div>
          <div class="ctl">
            <label>Label</label>
            <input type="text" placeholder="Placeholder">
            <p class="hints">(Hints) Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore.</p>
            <p class="examples">For example: <strong>example 1</strong>, <strong>example 2</strong>, or <strong>example 3</strong>.</p>
          </div>
        </div>

        <div class="band">
          <div class="info">Lorem ipsum dolor sit amet, cons ectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo conse.</div>
          <div class="ctl">
            <label>Label</label>
            <select>
              <option>Apples</option>
              <option>Bananas</option>
            </select>
            <p class="hints">(Hints) Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore.</p>
            <p class="examples">For example: <strong>example 1</strong>, <strong>example 2</strong>, or <strong>example 3</strong>.</p>
          </div>
        </div>

        <div class="band">
          <div class="info">Lorem ipsum dolor sit amet, cons ectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo conse.</div>
          <div class="ctl">
            <input type="checkbox"> <label>Label</label>
            <p class="hints">(Hints) Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore.</p>
            <p class="examples">For example: <strong>example 1</strong>, <strong>example 2</strong>, or <strong>example 3</strong>.</p>
          </div>
        </div>

        <div class="band">
          <div class="info">Lorem ipsum dolor sit amet, cons ectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo conse.</div>
          <div class="ctl">
            <label>Label</label>
            <textarea placeholder="your code goes here..."></textarea>
            <p class="hints">(Hints) Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore.</p>
            <p class="examples">For example: <strong>example 1</strong>, <strong>example 2</strong>, or <strong>example 3</strong>.</p>
          </div>
        </div>
      </form>
    </div>
    -->
    <img id="loading" src="/i/loading.svg"/>
  </div>
</div>

<script type="text/html" id="tpl--loading">
[[#
  {loading} template

  A simple SVG loading screen that keeps the viewer entertained while we
  go talk to SHIELD over AJAX, asynchronously.
]]
<img id="loading" src="/i/loading.svg"/>
</script>
<script type="text/html" id="tpl--banner">
[[#
  {banner} template

  Displays a message at the top of the viewport
]]
<p class="[[= _.type ]]">[[= _.message ]]</p>
</script>
<script type="text/html" id="tpl--error">
[[#
  {error} template

  Displays a page-wide error, for failures involving AJAX requests,
  unhandled exceptions, etc.
]]
    <div class="gutter blk error">
      <h2>Uh-oh &mdash; Something broke.</h2>
      <p id="message">[[= _.message ]]</p>
    </div>
</script>
<script type="text/html" id="tpl--restore-are-you-sure">
[[#
  {restore-are-you-sure}

  A modal interaction screen that requires the oeprator to acknowledge
  that what they are about to do is in fact to restore data, that it
  might be dangerous, and it might not work out.
]]
    <div class="confirm">
      <h2>You Are About To Restore Data</h2>
      <p>You have requested that S.H.I.E.L.D. restore <em>[[= _.target ]]</em>
      from a backup that was taken <em>[[= strftime("on %A, %B %d, %Y at %H:%M%P", _.taken) ]]</em> ([[= duration(tdiff(_.taken, new Date())) ]] ago).
      Any new data created after that point in time <em>will be lost</em>.</p>

      <p>Addtionally, the target system may be <em>offline or non-operational</em>
      while the restore operation is carried out.</p>

      <p class="q">Are you sure you want to restore <em>[[= _.target ]]</em>?</p>
      <div class="a">
        <button class="danger" rel="yes">Yes, Initiate Restore</button>
        <button class="safe" rel="close">No, Cancel This Operation</button>
      </div>
    </div>
</script>
<script type="text/html" id="tpl--top-bar">
[[#
  {top-bar} template

  Renders the top-most bar, with the SHIELD name / environment, and the
  current users name / tenant and "personal settings" menu.
]]
    <a href="#!/systems"><h1>SHIELD [[= _.shield.env ]] <span>[[= _.shield.ip ]]</span></h1>
    <p>[[= _.user.display ]] ([[= _.tenant.name ]])</p></a>


</script>
<script type="text/html" id="tpl--hud">
[[#
  {hud} template

  Renders the "health and wellness" heads-up display (HUD), with more
  information about this SHIELD instance (name / env / IP / version),
  health and key metrics.
]]
    <div class="x5"><div class="inst">
      <ul>
        <li class="shield">SHIELD <span class="v">[[= _.shield.version ]]</span></li>
        <li class="ip">[[= _.shield.ip ]]</li>
        <li class="fqdn">[[= _.shield.fqdn ]]</li>
        <li class="env"><span style="color: [[= maybe(_.shield.color, "#8CC63F") ]]">[[= _.shield.env ]]</span></li>
      </ul>
    </div></div>

    <div class="x5"><div class="health">
      <ul>
        [[ if (_.health.api_ok) { ]]
        <li class="ok"><object type="image/svg+xml" data="i/api-ok.svg"></object> SHIELD API is <span>up</span></li>
        [[ } else { ]]
        <li class="fail"><object type="image/svg+xml" data="i/api-fail.svg"></object> SHIELD API is <span>failing</span></li>
        [[ } ]]
        [[ if (_.health.storage_ok) { ]]
        <li class="ok"><object type="image/svg+xml" data="i/cloud-ok.svg"></object> Cloud Storage is <span>connected</span></li>
        [[ } else { ]]
        <li class="fail"><object type="image/svg+xml" data="i/cloud-fail.svg"></object> Cloud Storage is <span>failing</span></li>
        [[ } ]]
        [[ if (_.health.jobs_ok) { ]]
        <li class="ok"><object type="image/svg+xml" data="i/jobs-ok.svg"></object> All Jobs <span>succeeding</span></li>
        [[ } else { ]]
        <li class="fail"><object type="image/svg+xml" data="i/jobs-fail.svg"></object> Jobs are <span>failing</span></li>
        [[ } ]]
      </ul>
    </div></div>

    <div class="x6"><div class="prot">
      <h3>Data Protection Summary</h3>
      <ul>
        <li>Scheduled Backup Jobs <span>[[= _.stats.jobs ]]</span></li>
        <li>Backup Archives <span>[[= _.stats.archives ]]</span></li>
        <li class="warn">Cloud Storage Used <span>[[= _.stats.storage ]]</span></li>
        <li class="ok">Daily Storage Increase <span>[[= _.stats.daily ]]</span></li>
      </ul>
    </div></div>
</script>
<script type="text/html" id="tpl--404">
[[#
  {404} template

  Help a lost traveller on their way.
]]
    <div class="gutter blk e404">
      <h2>Oops.  We Couldn't Find That...</h2>
      <img src="/i/404.png" width="30%">
      <p>Looks like someone or some<em>thing</em> directed you to a part of the SHIELD
      web interface that just doesn't exist.  Bummer.  If you are sure this is SHIELD's
      fault (and it very well could be), please report an issues over at our
      <a href="https://github.com/starkandwayne/shield/issues/new" target="_blank">Github
      Page</a>.</p>

      <pre>You can paste this additional information
into your Github issue:

- **Wanted URL**: [[= _.wanted ]]
- **Arguments**:  ([[= _.args.join(', ') ]])
- **Referer**:    [[= maybe(_.referer, '_none_') ]]
</pre>
    </div>
</script>
<script type="text/html" id="tpl--systems">
[[#
  {systems} template

  Renders all targets visible to / manageable by the current user.
]]
    <div class="gutter blk">
      [[ $.each(_.systems, function (i, target) { ]]
      <div class="job card [[ if (!target.ok) { ]]fail[[ } else { ]]ok[[ } ]]">
        <a href="#!/systems/system:uuid:[[= target.uuid ]]">
        <img src="i/shield-[[= target.ok ? 'ok' : 'fail' ]].svg">
        <h3>[[= target.name ]]</h3>
        [[ $.each(target.jobs, function (j, job) { ]]
        <ul class="details">
          <li>runs [[= job.schedule ]]</li>
          <li>keep [[= job.keep.n ]] backups ([[= job.keep.days ]] days)</li>
        </ul>
        <div class="graph[[ if (!job.ok) { ]] fail[[ } ]]">
          <div class="from">[[= job.from ]]</div>
          <div class="bar"></div>
          <div class="to">[[= job.to ]]</div>
        </div>
        [[ }); ]]
        </a>
      </div>
      [[ }); ]]
    </div>
</script>
<script type="text/html" id="tpl--system">
[[#
  {system} template

  Renders all of the jobs and backup archives for a single target.
  Enables operators to easily see when a given system is backed up,
  and facilitates quick and easy access to restore valid archives.
]]
    <div class="gutter" data-system-uuid="[[= _.target.uuid ]]" data-system-name="[[= _.target.name ]]">
      <div class="job card [[= _.target.ok ? 'ok' : 'fail' ]]">
        <img src="i/shield-[[= _.target.ok ? 'ok' : 'fail' ]].svg">
        <h3>[[= _.target.name ]]</h3>
        [[ $.each(_.target.jobs, function (i, job) { ]]
        <ul class="details">
          <li>runs [[= job.schedule ]] &mdash; <a href="run:[[= job.uuid ]]">run now</a></li>
          <li>keep [[= job.keep.n ]] backups ([[= job.keep.days ]] days)</li>
        </ul>
        <div class="graph[[ if (!job.ok) { ]] fail[[ } ]]">
          <div class="from">[[= job.from ]]</div>
          <div class="bar"></div>
          <div class="to">[[= job.to ]]</div>
        </div>
        [[ }); ]]
      </div>

      <div class="job summary">
        <h2>Notes</h2>
        <p>[[= html(_.target.notes) ]]</p>
      </div>

      <h2>Timeline</h2>
      <div class="timeline">
          [[ $.each(_.target.tasks, function (i, task) { ]]
          <div class="event [[= task.type ]] [[= (task.status == 'done' ? 'ok' : task.status) ]][[ if (task.notes != "") { ]] noted[[ } ]][[ if (task.status != 'done' && task.ok) { ]] handled[[ } ]]" data-task-uuid="[[= task.uuid ]]"[[ if (task.archive) { ]] data-archive-uuid="[[= task.archive.uuid ]]" data-archive-taken="[[= task.started_at ]]"[[ } ]]>
            <ul>
              <li class="date">[[ if (task.status == 'scheduled') { ]]
                <em>scheduled / pending</em>
              [[ } else { ]]
                [[= strftime("%b %d %Y", task.started_at) ]]</li>
              [[ } ]]
              [[ if (task.archive) { ]]<li class="tag">[[= task.type ]]</li>[[ } ]]
              [[ if (task.type == "backup") { ]]
                [[ if (task.owner == "") { ]]
                <li class="desc">[[= maybe(task.archive.schedule, 'Scheduled Backup') ]]</li>
                <li class="meta">run automatically per job schedule</li>
                [[ } else { ]]
                <li class="desc">Ad Hoc Backup</li>
                <li class="meta">run by [[= task.owner ]] at [[= strftime("%l:%M%P", task.started_at) ]]</li>
                [[ } ]]
              [[ } else if (task.type == "restore") { ]]
                <li class="desc">Manual Restore</li>
                <li class="meta">run by [[= task.owner ]]</li>
              [[ } else if (task.type == "purge") { ]]
                <li class="desc">Purge Expired Archive</li>
                <li class="meta">...</li>
              [[ } else { ]]
                <li class="desc">[[= task.type ]] Task</li>
              [[ } ]]
              [[ if (task.notes != "") { ]]
              <li class="note"><strong>Note:</strong> [[= html(task.notes) ]]</li>
              [[ } ]]
              <li class="expand"><a href="task:[[= task.uuid ]]">full task log</a></li>
            </ul>
            <div class="task"></div>
          </div>
          [[ }); ]]
      </div>
    </div>
</script>
<script type="text/html" id="tpl--task">
[[#
  {task} template

  Displays the details of a single task, including the task log.
  Optionally, if this is being displayed in the {system} view,
  also display a big RESTORE button in the task output.
]]
<pre class="task-[[= _.task.status ]][[ if (_.task.ok) { ]] override[[ } ]]"><code><div>
<button class="annotate" rel="annotate:[[= _.task.uuid ]]">Annotate</button>[[ if (_.restorable) { ]]<button class="restore" rel="restore:[[= _.task.uuid ]]">Restore</button>[[ } ]]

<form class="annotate">
  <input type="hidden" name="uuid" value="[[= _.task.uuid ]]" />
  [[ if (_.task.status == "failed") { ]]
  <p><input type="checkbox" name="disposition"
            id="annotask-ok"[[ if (_.task.ok) { ]] checked[[ } ]]><label for="annotask-ok">Nothing to worry about</label></p>
  [[ } ]]
  <p><textarea name="notes" id="notes"
               placeholder="no notes recorded yet...">[[= maybe(_.task.notes, '') ]]</textarea></p>
  <button>Save</button>
</form>

</div><em>task <em>[[= _.task.uuid ]]</em></em>
<em>[[= _.task.type ]] task[[ if (_.task.started_at != "") { ]] started <em>[[= strftime("%c", _.task.started_at) ]][[ } ]]</em>[[
if (_.task.type == "purge") { ]]
purging archive <em>[[= _.task.archive_uuid ]]</em>[[
} else if (_.task.type == "restore") { ]]
restoring from archive <em>[[= _.task.archive_uuid ]]</em>[[
} ]]
initiated by <em>[[= _.task.owner ]]</em></em>

[[= _.task.log ]]

<em>[[ if (_.task.stopped_at > _.task.started_at && _.task.status != "pending") {
]]task ran for <em>[[= duration(tdiff(_.task.started_at, _.task.stopped_at)) ]]</em>
[[ }

if (_.task.type == 'backup') {
  if (_.task.archive_uuid != "") {
    ]]generated archive <em>[[= _.task.archive_uuid ]]</em>
for job <em>[[= _.task.job_uuid ]]</em>
[[
  } else {
  ]]no archive was generated.
[[
  }
} ]][[= _.task.type ]] task finished at <em>[[= strftime("%c", _.task.stopped_at) ]]</em> with status <em>[[= _.task.status ]]</em>
</em></code></pre>
</script>
<script type="text/html" id="tpl--stores">
[[#
  {stores} template

  Renders the currently defined (visible) storage endpoints,
  and in some cases allows for user-management of their configurations.
]]
    <div class="gutter blk">
      [[ $.each(_.stores, function (i, store) { ]]
      <div class="store card [[ if (!store.ok) { ]]fail[[ } else { ]]ok[[ } ]]">
        <a href="#!/stores/store:uuid:[[= store.uuid ]]">
        <img src="i/shield-[[= store.ok ? 'ok' : 'fail' ]].svg">
        <h3>[[= store.name ]]</h3>
        <div class="notes">[[ if (store.summary) { ]]
          [[= store.summary ]]
        [[ } else { ]]
          <div class="no-data">No summary provided.  Too bad.</div>
        [[ } ]]</div>
        <div class="graph[[ if (!store.ok) { ]] fail[[ } ]]">
          <div class="to">[[= store.plugin ]]</div>
        </div>
        </a>
      </div>
      [[ }); ]]
    </div>
</script>
<script type="text/html" id="tpl--store">
[[#
  {store} template

  Renders a single storage endpoint configuration, including its
  usage information and provide management capabilities.
]]
    <div class="gutter blk">
      <h2><div class="plugin">[[= _.store.plugin ]]</div>[[= _.store.name ]]</h2>

      <div class="meter">
        <svg width="500" height="400" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <style>
              rect.outer    { fill: #ccc; }
              rect.fill     { fill: #0071bc; }
              circle.marker { fill: #333; }
              line.marker { stroke: #333; stroke-width: 1px; }

              text.label      { font-size: 20px; font-family: sans-serif; }
              text.size       { font-size: 40px; font-family: sans-serif; }
              text.size tspan { font-size: 20px; font-weight: bold; }

              g.current      .size { fill: #7ac943; }
              g.current.warn .size { fill: orange; }
              g.threshold    .size { fill: #0071bc; }
              g.projected    .size { fill: #ff1d25; }
            </style>
          </defs>

          [[
              var total = Math.max(_.store.used, _.store.threshold, _.store.projected, _.store.total);
          ]]
          <rect class="outer" x="0" y="200" width="100%" height="36"></rect>
          <rect class="fill" x="2" y="202" width="[[= 100.0 * _.store.used / total ]]%" height="32"></rect>

          [[ if (_.store.threshold > _.store.used) { ]]
          <!-- "current" marker -->
          <g class="current" transform="translate(2)">
            <line class="marker" x1="[[= 100.0 * _.store.used / total ]]%" x2="[[= 100.0 * _.store.used / total ]]%" y1="198" y2="53"></line>
            <circle class="marker" cx="[[= 100.0 * _.store.used / total ]]%" cy="53" r="3"></circle>
            <g transform="translate(6)">
              <text x="[[= 100.0 * _.store.used / total ]]%" y="60" class="label">Current</text>
              <text x="[[= 100.0 * _.store.used / total ]]%" y="100" class="size">[[= _.store.used ]]<tspan>GB</tspan></text>
            </g>
          </g>

          <!-- "threshold" marker -->
          <g class="threshold" transform="translate(2)">
            <line class="marker" x1="[[= 100.0 * _.store.threshold / total ]]%" x2="[[= 100.0 * _.store.threshold / total ]]%" y1="198" y2="133"></line>
            <circle class="marker" cx="[[= 100.0 * _.store.threshold / total ]]%" cy="133" r="3"></circle>
            <g transform="translate(6)">
              <text x="[[= 100.0 * _.store.threshold / total ]]%" y="140" class="label">Threshold</text>
              <text x="[[= 100.0 * _.store.threshold / total ]]%" y="180" class="size">[[= _.store.threshold ]]<tspan>GB</tspan></text>
            </g>
          </g>
          [[ } else { ]]

          <!-- "threshold" marker -->
          <g class="threshold" transform="translate(2)">
            <line class="marker" x1="[[= 100.0 * _.store.threshold / total ]]%" x2="[[= 100.0 * _.store.threshold / total ]]%" y1="198" y2="53"></line>
            <circle class="marker" cx="[[= 100.0 * _.store.threshold / total ]]%" cy="53" r="3"></circle>
            <g transform="translate(6)">
              <text x="[[= 100.0 * _.store.threshold / total ]]%" y="60" class="label">Threshold</text>
              <text x="[[= 100.0 * _.store.threshold / total ]]%" y="100" class="size">[[= _.store.threshold ]]<tspan>GB</tspan></text>
            </g>
          </g>

          <!-- "current" marker -->
          <g class="current warn" transform="translate(2)">
            <line class="marker" x1="[[= 100.0 * _.store.used / total ]]%" x2="[[= 100.0 * _.store.used / total ]]%" y1="198" y2="133"></line>
            <circle class="marker" cx="[[= 100.0 * _.store.used / total ]]%" cy="133" r="3"></circle>
            <g transform="translate(6)">
              <text x="[[= 100.0 * _.store.used / total ]]%" y="140" class="label">Current</text>
              <text x="[[= 100.0 * _.store.used / total ]]%" y="180" class="size">[[= _.store.used ]]<tspan>GB</tspan></text>
            </g>
          </g>
          [[ } ]]

          <!-- "projected" marker -->
          <g class="projected" transform="translate(-3)">
            <line class="marker" x1="[[= 100.0 * _.store.projected / total ]]%" x2="[[= 100.0 * _.store.projected / total ]]%" y1="238" y2="293"></line>
            <circle class="marker" cx="[[= 100.0 * _.store.projected / total ]]%" cy="293" r="3"></circle>
            <g transform="translate(-6)"><text x="[[= 100.0 * _.store.projected / total ]]%" y="260" class="label" text-anchor="end">Projected</text>
              <text x="[[= 100.0 * _.store.projected / total ]]%" y="300" class="size" text-anchor="end">[[= _.store.projected ]]<tspan>GB</tspan></text>
            </g>
          </g>
        </svg>
      </div>
      <!-- #################################### -->

      <div class="side-by-side">
        <h3>Storage Details</h3>
        <dl>
          <dt>Backup Archives</dt>
          <dd>[[= _.store.archives ]]</dd>

          <dt>Storage Used</dt>
          <dd>[[= _.store.used ]]GB</dd>

          <dt>Daily Delta</dt>
          <dd>[[= _.store.daily_delta ]]GB</dd>
        </dl>
      </div>

      <div class="side-by-side">
        <h3>Configuration</h3>
        <dl>
          <dt>S3 Host</dt>
          <dd>fixme</dd>

          <dt>Access Key</dt>
          <dd>fixme</dd>

          <dt>Prefix Path</dt>
          <dd>/fix/me</dd>
        </dl>
      </div>
    </div>
</script>
<script type="text/html" id="tpl--policies">
[[#
  {policies} template

  Renders the list of all retention policies
]]
    <div class="gutter blk">
      <h2>Retention Policies</h2>
      [[ if (_.policies.length == 0) { ]]
      <div class="no-data">No Retention Policies have been created yet.</div>
      [[ } else { ]]
      <table>
        <thead><tr>
          <th>Name</th>
          <th>Retention Period</th>
          <th></th>
        </tr></thead>
        <tbody>
          [[ $.each(_.policies, function (i, policy) { ]]
          <tr>
            <td><a href="#">[[= policy.name ]]</a></td>
            <td>[[= policy.expiry ]] days</td>
            <td></td>
          </tr>
          [[ }); ]]
        </tbody>
      </table>
      [[ } ]]
    </div>
</script>
<script type="text/html" id="tpl--agents">
[[#
  {agents} template

  Renders the list of registered agents, with information about each
  registered agent, its version, health, etc.
]]
    <div class="gutter blk">
      <h2>Agents of SHIELD</h2>
      [[ if (_.agents.length == 0) { ]]
      <div class="no-data">No Agents have registered with this S.H.I.E.L.D. instance yet.</div>
      [[ } else { ]]
      <table>
        <thead><tr>
          <th>Name</th>
          <th>Address</th>
          <th>Version</th>
          <th>Status</th>
          <th>Last Seen</th>
          <th></th>
        </tr></thead>
        <tbody>
          [[ $.each(_.agents, function (i, agent) { ]]
               [[ var problems = _.problems[agent.uuid]; ]]
          <tr[[ if (problems.length != 0) { ]] class="noted fail"[[ } ]]>
            <td class="k">[[= agent.name ]]</td>
            <td>[[= agent.address ]]</td>
            <td>[[= agent.version ]]</td>
            <td>[[ if (agent.status == "ok") { ]]
              <span class="ok">[[= agent.status ]]</span>
            [[ } else { ]]
              <span class="fail">[[= agent.status ]]</span>
            [[ } ]]
            </td>
            <td>[[= trelative(agent.last_seen_at, 90*86400) ]]</td>
            <td></td>
          </tr>
          [[ if (problems.length != 0) { ]]
          <tr class="note fail">
            <td colspan="6">
              [[ $.each(problems, function (j, problem) { ]]
              <strong>Note:</strong><div>[[= problem ]]</div>
              [[ }); ]]
            </td>
          </tr>
          [[ } ]]
          [[ }); ]]
        </tbody>
      </table>
      [[ } ]]
    </div>
</script>
<script type="text/html" id="tpl--">
</script>

<!-- FIXME: colo jquery with our assets -->
<script script" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
/*
  When the viewer scrolls the browser window, check to see if we
  need to "stick" the navigation header to the top of the viewport,
  or re-attach it back to its relative position in the document flow.
 */
document.addEventListener('scroll', function(event) {
  var nav = document.getElementById("sticky-nav");
  var hud = document.getElementById("hud");
  var y = hud.clientHeight + hud.offsetTop;

  if (y - 29 <= window.scrollY) {
    nav.className = 'nav sticky on';
  } else if (y - 29 > window.scrollY) {
    nav.className = 'nav sticky';
  }
});

function tparse(d) {
  if (typeof d == "string") {
    // because we insist on doing bad things with date formatting in the API...
    m = /^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/.exec(d);
    if (!m) {
      console.log("'%s' doesn't look like a date/time string...", d);
      return ""
    }

    d = new Date();
    d.setTime(Date.UTC(parseInt(m[1]),   // year
                       parseInt(m[2])-1, // month
                       parseInt(m[3]),   // day
                       parseInt(m[4]),   // hour
                       parseInt(m[5]),   // minute
                       parseInt(m[6]))); // second
    return d;
  }

  if (!(d instanceof Date)) {
    var _d = new Date()
    if (!isNaN(d)) {
      _d.setTime(d * 1000);
    }
    return _d;
  }

  return d;
}
function tdiff(t1, t2) {
  return parseInt(tparse(t2).getTime() / 1000) - (tparse(t1).getTime() / 1000);
}

function duration(t) {
    t = parseInt(t);
    if (t < 0) { t = 0; }
    if (t < 60) {
      return t.toString() + "s";
    }
    if (t < 60 * 60) {
      return parseInt(t / 60).toString() + "m";
    }
    if (t < 60 * 60 * 24) {
      h = parseInt(t / (60 * 60));
      m = (t - h*(60 * 60)) / 60;
      return parseInt(h).toString() + "h " + parseInt(m).toString() + "m";
    }
    if (t < 60 * 60 * 24 * 7) {
      d = parseInt(t / (60 * 60 * 24));
      h = (t - d*(60 * 60 * 24)) / (60 * 60);
      return parseInt(d).toString() + "d " + parseInt(h).toString() + "h";
    }
    return parseInt(t / (60 * 60 * 24)).toString() + "d";
}

function trelative(d, threshold, fmt) {
  d = tparse(d);
  var now = new Date()

  if (threshold > 0 && now.getTime() - d.getTime() < threshold) {
    return duration(tdiff(d, now)) + " ago";
  }

  return strftime(fmt || "%x %X", d);
}

function strftime(fmt, d) {
  d = tparse(d);
  if (typeof(d) === 'undefined') {
    return "";
  }

  en_US = {
    pref: {
      /* %c */ datetime: function (d) { return strftime("%a %b %e %H:%M:%S %Y", d); },
      /* %x */ date:     function (d) { return strftime("%m/%d/%Y", d); },
      /* %X */ time:     function (d) { return strftime("%H:%M:%S", d); }
    },
    weekday: {
      abbr: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
      full: ['Sunday',
             'Monday',
             'Tuesday',
             'Wednesday',
             'Thursday',
             'Friday',
             'Saturday']
    },
    month: {
      abbr: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
             'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      full: ['January',
             'February',
             'March',
             'April',
             'May',
             'June',
             'July',
             'August',
             'September',
             'October',
             'November',
             'December']
    },
    AM: "AM", am: "am", PM: "PM", pm: "pm",
    ordinal: ['th', 'st', 'nd', 'rd', 'th', 'th', 'th', 'th', 'th', 'th', 'th', //  1 - 10
                    'th', 'th', 'th', 'th', 'th', 'th', 'th', 'th', 'th', 'th', // 11 - 20
                    'st', 'nd', 'rd', 'th', 'th', 'th', 'th', 'th', 'th', 'th', // 21 - 30
                    'st'],
    zero:  ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09',
            '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
            '20', '21', '22', '23', '24', '25', '26', '27', '28', '29',
            '30', '31', '32', '33', '34', '35', '36', '37', '38', '39',
            '40', '41', '42', '43', '44', '45', '46', '47', '48', '49',
            '50', '51', '52', '53', '54', '55', '56', '57', '58', '59'],

    space: [' 0', ' 1', ' 2', ' 3', ' 4', ' 5', ' 6', ' 7', ' 8', ' 9',
            '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
            '20', '21', '22', '23', '24', '25', '26', '27', '28', '29',
            '30', '31', '32', '33', '34', '35', '36', '37', '38', '39',
            '40', '41', '42', '43', '44', '45', '46', '47', '48', '49',
            '50', '51', '52', '53', '54', '55', '56', '57', '58', '59'],
  };

  var lc = en_US;

  var inspec = false;
  var alt_o  = false;

  var s = '';
  for (var i = 0; i < fmt.length; i++) {
    var c = fmt.charCodeAt(i);
    if (inspec) {
      switch (c) {
      // %%   A literal '%' character
      case 37:
        s += '%';
        break;

      // %a   The abbreviated name of the day of the week according to the
      //      current locale.
      case 97:
        s += lc.weekday.abbr[d.getDay()];
        break;

      // %A   The full name of the day of the week according to the current
      //      locale.
      case 65:
        s += lc.weekday.full[d.getDay()];
        break;

      // %b   The abbreviated month name according to the current locale.
      case 98:
        s += lc.month.abbr[d.getMonth()];
        break;

      // %h   Equivalent to %b.
      case 104:
        s += lc.month.abbr[d.getMonth()];
        break;

      // %B   The full month name according to the current locale.
      case 66:
        s += lc.month.full[d.getMonth()];
        break;

      // %c   The preferred date and time representation for the current
      //      locale.
      case 99:
        s += lc.pref.datetime(d);
        break;

      // %C   The century number (year/100) as a 2-digit integer
      case 67:
        s += d.getFullYear() / 100;
        break;

      // %d   The day of the month as a decimal number (range 01 to 31).
      case 100:
        s += lc.zero[d.getDate()];
        break;

      // %D   Equivalent to %m/%d/%y.  (Yecch—for Americans only.  Americans
      //      should note that in other countries %d/%m/%y is rather common.
      //      This means that in international context this format is
      //      ambiguous and should not be used.)
      case 68:
        s += strftime("%m/%d/%y", d);
        break;

      // %e   Like %d, the day of the month as a decimal number, but a
      //      leading zero is replaced by a space.
      case 101:
        s += d.getDate().toString()+(alt_o ? lc.ordinal[d.getDate()] : '');
        break;

      // %E   Modifier: use alternative format, see below.
      case 69:
        // not supported; just skip it
        continue;

      // %F   Equivalent to %Y-%m-%d (the ISO 8601 date format).
      case 70:
        s += strftime("%Y-%m-%d", d);
        break;

      // %G   The ISO 8601 week-based year (see NOTES) with century as a
      //      decimal number.  The 4-digit year corresponding to the ISO
      //      week number (see %V).  This has the same format and value as
      //      %Y, except that if the ISO week number belongs to the previous
      //      or next year, that year is used instead.
      case 71:
        throw "this strftime() does not support '%G'"; // FIXME

      // %g   Like %G, but without century, that is, with a 2-digit year
      //      (00-99).
      case 103:
        throw "this strftime() does not support '%g'"; // FIXME

      // %H   The hour as a decimal number using a 24-hour clock (range 00 to 23).
      case 72:
        s += lc.zero[d.getHours()]
        break;

      // %I   The hour as a decimal number using a 12-hour clock (range 01 to 12)
      case 73:
        s += lc.zero[d.getHours() % 12 == 0 ? 12 : d.getHours() % 12];
        break;

      // %j   The day of the year as a decimal number (range 001 to 366).
      case 106:
        throw "this strftime() does not support '%j'"; // FIXME

      // %k   The hour (24-hour clock) as a decimal number (range 0 to 23);
      //      single digits are preceded by a blank.  (See also %H.)
      case 107:
        s += lc.space[d.getHours()];
        break;

      // %l   The hour (12-hour clock) as a decimal number (range 1 to 12);
      //      single digits are preceded by a blank.  (See also %I.)
      case 108:
        s += lc.space[d.getHours() % 12 == 0 ? 12 : d.getHours() % 12];
        break;

      // %m   The month as a decimal number (range 01 to 12).
      case 109:
        s += lc.zero[d.getMonth()+1];
        break;

      // %M   The minute as a decimal number (range 00 to 59).
      case 77:
        s += lc.zero[d.getMinutes()];
        break;

      // %n   A newline character.
      case 110:
        s += "\n";
        break;

      // %O   Modifier: use alternative format, see below.
      case 79:
        alt_o = true;
        continue;

      // %p   Either "AM" or "PM" according to the given time value, or the
      //      corresponding strings for the current locale.  Noon is treated
      //      as "PM" and midnight as "AM".
      case 112:
        s += (d.getHours() < 12 ? lc.AM : lc.PM);
        break;

      // %P   Like %p but in lowercase: "am" or "pm" or a corresponding
      //      string for the current locale.
      case 80:
        s += (d.getHours() < 12 ? lc.am : lc.pm);
        break;

      // %r   The time in a.m. or p.m. notation.  In the POSIX locale this
      //      is equivalent to %I:%M:%S %p.
      case 114:
        s += lc.zero[d.getHours() % 12 == 0 ? 12 : d.getHours() % 12] + ":" +
             lc.zero[d.getMinutes()]                                  + ":" +
             lc.zero[d.getSeconds()]                                  + " " +
             (d.getHours() < 12 ? lc.AM : lc.PM);
        break;

      // %R   The time in 24-hour notation (%H:%M).  For a version
      //      including the seconds, see %T below.
      case 82:
        s += lc.zero[d.getHours()] + ":" +
             lc.zero[d.getMinutes()];
        break;

      // %s   The number of seconds since the Epoch,
      //      1970-01-01 00:00:00+0000 (UTC).
      case 115:
        s += d.getTime().toString();
        break;

      // %S   The second as a decimal number (range 00 to 60).  (The range
      //      is up to 60 to allow for occasional leap seconds.)
      case 83:
        s += lc.zero[d.getSeconds()];
        break;

      // %t   A tab character.
      case 116:
        s += "\t";
        break;

      // %T   The time in 24-hour notation (%H:%M:%S).
      case 84:
        s += lc.zero[d.getHours()]   + ":" +
             lc.zero[d.getMinutes()] + ":" +
             lc.zero[d.getSeconds()];
        break;

      // %u   The day of the week as a decimal, range 1 to 7, Monday being 1.
      //       See also %w.
      case 117:
        s += (d.getDay()+1).toString()+(alt_o ? lc.ordinal[d.getDay()+1] : '');
        break;

      // %U   The week number of the current year as a decimal number, range
      //      00 to 53, starting with the first Sunday as the first day of
      //      week 01.  See also %V and %W.
      case 85:
        throw "this strftime() does not support '%U'"; // FIXME

      // %V   The ISO 8601 week number (see NOTES) of the current year as a
      //      decimal number, range 01 to 53, where week 1 is the first week
      //      that has at least 4 days in the new year.  See also %U and %W.
      case 86:
        throw "this strftime() does not support '%V'"; // FIXME

      // %w   The day of the week as a decimal, range 0 to 6, Sunday being 0
      //      See also %u.
      case 119:
        s += (d.getDay()).toString();
        break;

      // %W   The week number of the current year as a decimal number, range
      //      00 to 53, starting with the first Monday as the first day of
      //      week 01.
      case 87:
        throw "this strftime() does not support '%W'"; // FIXME

      // %x   The preferred date representation for the current locale
      //      without the time.
      case 120:
        s += lc.pref.date(d);
        break;

      // %X   The preferred time representation for the current locale
      //      without the date.
      case 88:
        s += lc.pref.time(d);
        break;

      // %y   The year as a decimal number without a century (range 00 to 99).
      case 121:
        s += lc.zero[d.getFullYear() % 100];
        break;

      // %Y   The year as a decimal number including the century.
      case 89:
        s += d.getFullYear();
        break;

      // %z   The +hhmm or -hhmm numeric timezone (that is, the hour and
      //      minute offset from UTC).
      case 122:
        throw "this strftime() does not support '%z'"; // FIXME

      // %Z   The timezone name or abbreviation.
      case 90:
        throw "this strftime() does not support '%Z'"; // FIXME

      default:
        throw "unrecognized strftime sequence '%"+fmt[i]+"'";
      }

      inspec = false;
      alt_o  = false;
      continue;
    }

    if (c == 37) { // %
      inspec = true
      continue;
    }

    s += fmt[i];
  }
  return s;
}

/*
  task_id() - Truncate a Task UUID, maintaining identifiability
 */
function task_id(t) {
  if (t instanceof Object) {
    if (!'uuid' in t) { return "[unknown]" }
    t = t.uuid;
  }
  return t.toString().substr(0,7);
}

/*
  banner() - Display a small banner at the top of the viewport
 */
var banner = (function () {
  var timer = undefined;
  var $banner = null;

  return function (message, type) {
    if (typeof timer !== 'undefined') {
      window.cancelTimeout(timer);
      timer = undefined;
    }

    if (!$banner) { $(document.body).append( $banner = $('<div class="banner-top">').hide() ); }
    if (typeof type == 'undefined') { type = 'info' }
    $banner.show('fade').html(template('banner', {
      type:    type,
      message: message
    }));
    time = window.setTimeout(function () {
      $banner.hide('fade');
    }, 7000);
  };
}());

/*
   modal() - Display a modal dialog that the user must interact with
 */
var modal = (function () {
  var $wash = $('<div id="modal" class="modal-wash"></div>').hide();
  $(document.body).append($wash);

  $wash.on('click', '[rel="close"]', function (event) {
    event.preventDefault();
    $wash.hide();
  });

  return function (html) {
    var $window = $(html);
    $wash.hide().empty().append($window).show();
    return $window;
  }
}());

/*
  compile() - Compile a <script> template into a JS function

  The resulting function can be passed a data object and it will
  execute the logic in the template to produce a string of HTML
  (hopefully) for inclusion in some part of the page DOM.

  The template language is javascript, embedded in HTML:

    [[= expr ]]   Evaluate expression and concatenate the result
                  to the output string.

    [[ stmt ]]    Execute stmt; if it produces a value, discard
                  the value.  Useful for embedding control-flow
                  into the template.
 */
function compile(src) {
  var tokenizer = new RegExp('([\\s\\S]*?)\\[\\[([\\s\\S]*?)\\]\\]([\\s\\S]*)');
  var str = function (s) {
    if (!s) { return "''"; }
    return "'"+s.replace(/(['\\])/g, '\\$1').replace(/\n/g, "\\n")+"'";
  };

  var code = [];
  for (;;) {
    var tokens = tokenizer.exec(src)
    if (!tokens) {
      code.push('__ += '+str(src)+';');
      break;
    }
    code.push('__ += '+str(tokens[1])+';');
    if (tokens[2][0] == '=') {
      code.push('__ += ('+tokens[2].replace(/^=\s*/, '')+');');
    } else if (tokens[2][0] != '#') { /* skip comments */
      code.push(tokens[2]);
    }
    src = tokens[3];
  }
  code = code.join('');
  return function (_) {
    var __ = '';
    var maybe = function (a,b) { return typeof(a) !== 'undefined' ? a : b; };
    var html  = function (s) {
      return $('<textarea>').text(s).html()
        .replace(/&lt;(https?:.+?)&gt;/g, '<a target="_blank" href="$1">$1</a>')
        .replace(/\n/g, '<br>'); };

    eval(code);
    return __;
  };
}

/*
  Set up Template handlers for the dynamic parts of the page
 */
var Templates = {};
function template(name, data) {
  if (!(name in Templates)) {
    Templates[name] = compile($('script#tpl--'+name).html());
  }
  return Templates[name](data);
}

var referer = undefined;
function dispatch(page) {
  if (!page || page == "") { page = "#!/systems"; }
  var argv = page.split(':');
  page = argv.shift();
  var top = page.replace(/^(#!\/[^\/]+)(\/.*)?$/, '$1');

  args = {};
  for (var i = 0; i < argv.length; i += 2) {
    args[argv[0+i]] = argv[1+i]
  }
  $('nav li.current').removeClass('current');
  $('nav a[href="'+top+'"]').closest('li').addClass('current');

  switch (page) {
  case "#!/systems": /* {{{ */
    $('#main').html(template('loading'));
    $.ajax({
      type: 'GET',
      url:  '/v2/systems',
      success: function (data) {
        $('#main').html(template('systems', { systems: data }));
      },
      error: function (xhr) {
        console.log(arguments);
        $('#main').html(template('error', {
          http:     xhr.status + ' ' + xhr.statusText,
          response: xhr.responseText,
          message:  "Failed retrieving the list of protected systems from the SHIELD API."
        }));
      }
    });
    break; /* #!/systems */
    // }}}
  case '#!/systems/system': /* {{{ */
    $('#main').html(template('loading'));
    $.ajax({
      type: 'GET',
      url:  '/v2/systems/'+args.uuid, /* FIXME: handle missing uuid */
      success: function (data) {
        $('#main').html(template('system', { target: data }));
      },
      error: function (xhr) {
        console.log(arguments);
        $('#main').html(template('error', {
          http:     xhr.status + ' ' + xhr.statusText,
          response: xhr.responseText,
          message:  "Failed retrieving metadata for protected system from the SHIELD API."
        }));
      }
    });
    break; /* #!/systems/system */
    // }}}
  case '#!/stores': /* {{{ */
    $('#main').html(template('loading'));
    $.ajax({
      type: 'GET',
      url:  '/v1/stores',
      success: function (data) {
        /*
          {
            uuid: '4a013967-9295-499a-8cc4-ace60f721704',
            name: 'Scality (On-Premise)',
            ok: false,
            plugin: 'scality',
            summary: 'On-premise storage, to be used for short-term...'
          }
         */
        /* FIXME fixups that need to migrate into the SHIELD code */
        for (key in data) {
          if (!('ok' in data[key])) {
            data[key].ok = true;
          }
        }
        $('#main').html(template('stores', { stores: data }));
      },
      error: function (xhr) {
        console.log(arguments);
        $('#main').html(template('error', {
          http:     xhr.status + ' ' + xhr.statusText,
          response: xhr.responseText,
          message:  "Failed retrieving the list of storage endpoints from the SHIELD API."
        }));
      }
    });
    break; /* #!/stores */
    // }}}
  case '#!/stores/store': /* {{{ */
    var used = 200.1;
    var projected = 201.7;
    var threshold = 180;
    $('#main').html(template('store', {
      store: {
        uuid: '4a013967-9295-499a-8cc4-ace60f721704',
        name: 'Scality (On-Premise)',
        ok: false,
        plugin: 'scality',
        archives: 224,
        used: 200.1,
        threshold: 180,
        projected: 600.7,
        total: 201.7,
        daily_delta: '+1.3',
        notes: 'On-premise Scality storage, to be used for short-term, high-volume backup archives.  These go to to the <kbd>xyzy</kbd> bucket.'
      }
    }));
    break; /* #!/stores/store */
    // }}}
  case '#!/policies': /* {{{ */
    $('#main').html(template('policies', {
      policies: [
        {
          name: 'Long-term',
          expiry: 90
        }
      ]
    }));
    break; /* #!/policies */
    // }}}
  case '#!/admin/agents': /* {{{ */
    $('#main').html(template('loading'));
    $.ajax({
      type: 'GET',
      url:  '/v2/agents',
      success: function (data) {
      /*
       [{
          problems: []
        }]
       */
        $('#main').html(template('agents', data));
      },
      error: function (xhr) {
        console.log(arguments);
        $('#main').html(template('error', {
          http:     xhr.status + ' ' + xhr.statusText,
          response: xhr.responseText,
          message:  "Failed retrieving the list of agents from the SHIELD API."
        }));
      }
    });
    break; /* #!/admin/agents */
    // }}}
  default:
    $('#main').html(template('404', {
      wanted:  page,
      args:    argv,
      referer: referer,
    }));
    return; /* 404 */
  }

  referer = page;
}

function reload() {
  dispatch(document.location.hash);
}

$(function () {
  $(window).on('hashchange', function (event) {
    dispatch(document.location.hash);
  }).trigger('hashchange');


  (function (s) {
    var RUNNING = false;
    var last = "";

    var ping = function () {
      if (RUNNING) { return; }
      RUNNING = true;
      $.ajax({
        type: 'GET',
        url:  '/v2/health',
        success: function (data) {
          var json = JSON.stringify(data);
          if (json != last) {
            $('#hud').html(template('hud', data));
            $('.top-bar').html(template('top-bar', {
              shield: {
                env: 'DEMO',
                ip:  data.shield.ip
              },
              user: {
                display: 'James Hunt'
              },
              tenant: {
                name: 'Stark & Wayne'
              }
            }));
          }
          last = json;
        },
        complete: function () {
          RUNNING = false;
        }
      });
    }
    ping();
    window.setInterval(ping, s * 1000);
  })(5);

  /*
  $('#hud').html(template('hud', {
    shield: {
      env: 'PRODUCTION',
      ip:  '1.2.3.4',
      fqdn: 'shield.example.com',
      version: '6.7.2',
    },
    health: {
      api_ok     : false,
      storage_ok : true,
      jobs_ok    : true
    },
    stats: {
      jobs: 123,
      archives: 123456,
      storage: '207.32G',
      daily_add: '+2.3M'
    }
  }));
  */

  /* show a task in the next row down. */
  $('#main').on('click', 'a[href^="task:"]', function (event) {
    event.preventDefault();
    var uuid  = $(event.target).closest('a[href^="task:"]').attr('href').replace(/^task:/, '');
    var $ev   = $(event.target).closest('.event');
    var $task = $ev.find('.task');

    if ($task.is(':visible')) {
      $task.hide();
      return;
    }

    $task = $task.show()
                 .html(template('loading'));

    $.ajax({
      type: 'GET',
      url:  '/v1/task/'+uuid,
      success: function (data) {
        $task.html(template('task', {
          task: data,
          restorable: data.archive_uuid != "" && data.status == "done",
        }));
      },
      error: function (xhr) {
        throw "oops"; // FIXME
      }
    });
  });

  /* show an annotation form, in a task log */
  $('#main').on('click', '.task button[rel^="annotate:"]', function (event) {
    console.log('annotating!');
    $(event.target).closest('.task').find('form.annotate').toggle();
  });

  $('#main').on('click', 'a[href^="run:"]', function (event) {
    event.preventDefault();
    var uuid  = $(event.target).closest('a[href^="run:"]').attr('href').replace(/^run:/, '');

    banner('scheduling ad hoc backup...', 'progress');
    $.ajax({
      type: 'POST',
      url:  '/v1/job/'+uuid+'/run',
      success: function (data) {
        banner('ad hoc backup job scheduled');
        reload();
      },
    });
  });

  $('#main').on('click', '.task button[rel^="restore:"]', function (event) {
    var uuid   = $(event.target).closest('[data-archive-uuid]').data('archive-uuid');
    var target = $(event.target).closest('[data-system-name]').data('system-name');
    var taken  = $(event.target).closest('[data-archive-taken]').data('archive-taken');
    console.log('restoring archive %s!', uuid);

    modal(template('restore-are-you-sure', {
        target: target,
        taken:  taken
      })).on('click', '[rel=yes]', function(event) {
      event.preventDefault();
      $.ajax({
        type: 'POST',
        url:  '/v1/archive/'+uuid+'/restore',
        success: function() {
          banner("restore operation started");
        }
      });
    });
  });

  /* submit the annotation form */
  $('#main').on('submit', '.task form.annotate', function (event) {
    event.preventDefault();

    var $form = $(event.target);
    var uuid = $form.closest('[data-system-uuid]').data('system-uuid');

    if ($form.is('[data-system-uuid] [data-task-uuid] *')) {
      var ann = {
        type  : "task",
        uuid  : $form.find('[name=uuid]').val(),
        notes : $form.find('[name=notes]').val()
      };
      if ($form.find('input[name=disposition]').length > 0) {
        ann.disposition = $form.find('input[name=disposition]').is(':checked')
                        ? "ok" : "failed";
      }
      ann.clear = $form.find('[optgroup=clear]:checked').val();
      if (ann.clear == '') {
        ann.clear = "normal";
      }

      $.ajax({
        type: 'PATCH',
        url:  '/v2/systems/'+uuid,

        contentType: 'application/json',
        data: JSON.stringify({ "annotations": [ann] }),
        success: function (data) {
          $form.hide();
          banner("task annotation saved.");
          reload();
        },
        error: function (xhr) {
          $form.hide();
          banner("task annotation failed to save.", 'error');
        }
      });

    } else {
      throw 'unexpected annotation form (not a .tasks or .archives descendent)'
    }
  });
});
</script>

<script type="text/javascript">
$('form').on('click', '.ctl', function (event) {
  $(event.target).closest('form').find('.band.active').removeClass('active');
  $(event.target).closest('.band').addClass('active');
});
$('form').on('focus', 'input, textarea, select', function (event) {
  $(event.target).closest('form').find('.band.active').removeClass('active');
  $(event.target).closest('.band').addClass('active');
});
</script>

</body>
</html>
